{"version":3,"sources":["../src/Queryable.js"],"names":["queryConverter","QueryConverter","Queryable","type","query","provider","_applyQuery","where","nodeName","OperationExpression","skip","take","Infinity","Array","isArray","orderBy","filter","_isValidOrderBy","_isValidMapping","select","Error","obj","clone","Date","_isObject","Object","keys","forEach","key","_cloneObject","copy","lambda","_copyQuery","getQuery","whereExpression","ExpressionBuilder","Expression","wrapper","children","push","length","rightExpression","leftExpression","pop","expression","mapping","every","column","name","isNaN","parseInt","charAt","properties","hasValidMapping","property","_validatePropertyName","existingMapping","mappingKeys","_createQueryableFromLambda","queryable","_assertHasProvider","countAsync","cloneQuery","andExpression","index","findIndex","cloneOrderBy","_selectArray","_selectObject","value","toArrayAsync","toArrayWithCountAsync","JSON","stringify","jsonQuery","convert"],"mappings":"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","file":"Queryable.js","sourcesContent":["import Expression from \"./Expression\";\nimport ExpressionBuilder from \"./ExpressionBuilder\";\nimport OperationExpression from \"./OperationExpression\";\nimport OperationExpressionBuilder from \"./OperationExpressionBuilder\";\nimport ValueExpression from \"./ValueExpression\";\nimport QueryConverter from \"./QueryConverter\";\n\nconst queryConverter = new QueryConverter();\n\nexport default class Queryable {\n    constructor(type, query = {}) {\n        this.type = type || \"Object\";\n        this.provider = null;\n        this.query = query;\n        this._applyQuery(query);\n    }\n\n    _applyQuery(query) {\n        if (query.where != null && query.where.nodeName === \"where\") {\n            this.query.where = query.where;\n        } else {\n            this.query.where = new OperationExpression(\"where\");\n        }\n\n        if (typeof query.skip === \"number\") {\n            this.query.skip = query.skip;\n        } else {\n            this.query.skip = 0;\n        }\n\n        if (typeof query.take === \"number\") {\n            this.query.take = query.take;\n        } else {\n            this.query.take = Infinity;\n        }\n\n        if (Array.isArray(query.orderBy)) {\n            this.query.orderBy = query.orderBy.filter((orderBy) => {\n                return this._isValidOrderBy(orderBy);\n            });\n        } else {\n            this.query.orderBy = [];\n        }\n\n        if (this._isValidMapping(this.query.select)) {\n            this.query.select = query.select;\n        } else {\n            this.query.select = {};\n        }\n\n        this.query.type = this.type;\n\n    }\n\n    _assertHasProvider() {\n        if (!this.provider) {\n            throw new Error(\"No provider found.\");\n        }\n    }\n\n    // _cloneObject(object){\n    //     return JSON.parse(JSON.stringify(object));\n    // }\n\n    _cloneObject(obj) {\n        let clone;\n\n        if (obj instanceof Date) {\n            return new Date(obj);\n        } else if (this._isObject(obj)) {\n            clone = {};\n        } else if (Array.isArray(obj)) {\n            clone = [];\n        } else {\n            return obj;\n        }\n\n        Object.keys(obj).forEach((key) => {\n            clone[key] = this._cloneObject(obj[key]);\n        });\n\n        return clone;\n    }\n\n    _copyQuery(query) {\n        let copy = {};\n\n        copy.where = query.where.copy();\n        copy.orderBy = this._cloneObject(query.orderBy);\n        copy.select = this._cloneObject(query.select);\n        copy.take = query.take;\n        copy.skip = query.skip;\n        copy.type = query.type;\n\n        return copy;\n    }\n\n    _createQueryableFromLambda(type, lambda = () => { }) {\n        let query = this._copyQuery(this.getQuery());\n        let whereExpression;\n\n        if (typeof lambda === \"function\") {\n            whereExpression = lambda(new ExpressionBuilder(this.type));\n        } else if (lambda instanceof Expression) {\n            whereExpression = lambda;\n        } else {\n            throw new Error(\"Invalid Argument: Expected an expression, or function.\");\n        }\n\n        if (!(whereExpression instanceof Expression)) {\n            throw new Error(\"Invalid expression: You may be missing a return.\");\n        }\n\n        if (whereExpression.nodeName !== \"where\") {\n            let wrapper = new OperationExpression(\"where\");\n            wrapper.children.push(whereExpression);\n            whereExpression = wrapper;\n        }\n\n        if (query.where.children.length === 0) {\n            query.where = whereExpression;\n        } else {\n\n            let rightExpression = whereExpression.children[0];\n            let leftExpression = query.where.children.pop();\n            let expression = new OperationExpression(type);\n\n            expression.children.push(\n                leftExpression,\n                rightExpression\n            );\n\n            query.where.children.push(expression);\n        }\n\n        return this.copy(query);\n    }\n\n    _isObject(obj) {\n        return typeof obj === \"object\" && obj != null && !Array.isArray(obj);\n    }\n\n    _isValidMapping(mapping) {\n        if (mapping == null) {\n            return false;\n        }\n\n        return Object.keys(mapping).every((key) => {\n            return typeof key === \"string\" && typeof mapping[key] === \"string\";\n        });\n    }\n\n    _isValidOrderBy(orderBy) {\n        let keys = Object.keys(orderBy);\n\n        if (keys.length !== 2) {\n            return false;\n        }\n\n        if (orderBy.type !== \"ASC\" && orderBy.type !== \"DESC\") {\n            return false;\n        }\n\n        if (typeof orderBy.column !== \"string\") {\n            return false;\n        }\n\n        return true;\n    }\n\n    _validatePropertyName(name) {\n        return typeof name === \"string\" && name.length > 0 && isNaN(parseInt(name.charAt(0), 10))\n    }\n\n    _selectArray(properties) {\n        let hasValidMapping = properties.every((property) => {\n            return this._validatePropertyName(property);\n        });\n\n        if (!hasValidMapping) {\n            throw new Error(\"Invalid mapping: The mappings need to be a string that is at least one character long and doesn't start with a number.\");\n        }\n\n        let query = this._copyQuery(this.getQuery());\n        let existingMapping = query.select;\n\n        properties.forEach((property) => {\n            existingMapping[property] = property;\n        });\n\n        return this.copy(query);\n    }\n\n    _selectObject(mapping) {\n        let mappingKeys = Object.keys(mapping);\n        let hasValidMapping = mappingKeys.every((key) => {\n            return this._validatePropertyName(key) && this._validatePropertyName(mapping[key]);\n        });\n\n        if (!hasValidMapping) {\n            throw new Error(\"Invalid mapping: The mappings need to be a string that is at least one character long and doesn't start with a number.\");\n        }\n\n        let query = this._copyQuery(this.getQuery());\n        let existingMapping = query.select;\n\n        mappingKeys.forEach((key) => {\n            existingMapping[key] = mapping[key];\n        });\n\n        return this.copy(query);\n    }\n\n    and(lambda) {\n        return this._createQueryableFromLambda(\"and\", lambda);\n    }\n\n    copy(query) {\n        let queryable = new Queryable(this.type, query || this._copyQuery(this.query));\n        queryable.provider = this.provider;\n        return queryable;\n    }\n\n    countAsync() {\n        this._assertHasProvider(this);\n        return this.provider.countAsync(this);\n    }\n\n    getExpression() {\n        return this.query;\n    }\n\n    getQuery() {\n        return this.query;\n    }\n\n    merge(queryable) {\n        if (!(queryable instanceof Queryable)) {\n            throw new Error(\"Expected a queryable to be passed in.\");\n        }\n\n        let cloneQuery = this._copyQuery(this.getQuery());\n        let query = queryable.getQuery();\n\n        let rightExpression = query.where.children[0];\n\n        if (rightExpression != null) {\n            // No need to copy if there is nothing to copy.\n            if (cloneQuery.where.children.length === 0) {\n                cloneQuery.where.children.push(rightExpression.copy());\n            } else if (cloneQuery.where.children.length === 1 && cloneQuery.where.children[0].nodeName === \"and\") {\n                cloneQuery.where.children[0].children.push(rightExpression.copy());\n            } else {\n                let leftExpression = cloneQuery.where.children.pop();\n                let andExpression = new OperationExpression(\"and\");\n\n                andExpression.children.push(\n                    leftExpression,\n                    rightExpression.copy()\n                );\n\n                cloneQuery.where.children.push(andExpression);\n            }\n        }\n\n        Object.keys(query.select).forEach((key) => {\n            cloneQuery.select[key] = this._cloneObject(query.select[key]);\n        });\n\n        query.orderBy.forEach((orderBy) => {\n            let index = cloneQuery.orderBy.findIndex((cloneOrderBy) => {\n                return cloneOrderBy.column === orderBy.column;\n            });\n\n            if (index === -1) {\n                cloneQuery.orderBy.push(this._cloneObject(orderBy));\n            }\n        });\n\n        cloneQuery.type = query.type;\n        cloneQuery.take = query.take;\n        cloneQuery.skip = query.skip;\n\n        return this.copy(cloneQuery);\n    }\n\n    or(lambda) {\n        return this._createQueryableFromLambda(\"or\", lambda);\n    }\n\n    orderBy(property) {\n        if (typeof property !== \"string\") {\n            throw new Error(\"Illegal Argument: property needs to be of type string.\");\n        }\n\n        let query = this._copyQuery(this.getQuery());\n\n        let index = query.orderBy.findIndex((orderBy) => {\n            return orderBy.column === property;\n        });\n\n        if (index === -1) {\n            query.orderBy.push({\n                type: \"ASC\",\n                column: property\n            });\n        }\n\n        return this.copy(query);\n    }\n\n    orderByDesc(property) {\n        if (typeof property !== \"string\") {\n            throw new Error(\"Illegal Argument: property needs to be of type string.\");\n        }\n\n        let query = this._copyQuery(this.getQuery());\n\n        let index = query.orderBy.findIndex((orderBy) => {\n            return orderBy.column === property;\n        });\n\n        if (index === -1) {\n            query.orderBy.push({\n                type: \"DESC\",\n                column: property\n            });\n        }\n\n        return this.copy(query);\n    }\n\n    select(mapping) {\n        if (Array.isArray(mapping)) {\n            return this._selectArray(mapping)\n        } else {\n            return this._selectObject(mapping);\n        }\n    }\n\n    skip(value) {\n        if (typeof value !== \"number\") {\n            throw new Error(\"Illegal Argument: skip needs to be a number.\");\n        }\n\n        let query = this._copyQuery(this.getQuery());\n        query.skip = value\n\n        return this.copy(query);\n    }\n\n    take(value) {\n        if (typeof value !== \"number\") {\n            throw new Error(\"Illegal Argument: take needs to be a number.\");\n        }\n\n        let query = this._copyQuery(this.getQuery());\n        query.take = value\n\n        return this.copy(query);\n    }\n\n    toArrayAsync() {\n        this._assertHasProvider(this);\n        return this.provider.toArrayAsync(this);\n    }\n\n    toArrayWithCountAsync() {\n        this._assertHasProvider(this);\n        return this.provider.toArrayWithCountAsync(this);\n    }\n\n    toJson() {\n        return JSON.stringify(this.getQuery());\n    }\n\n    where(lambda) {\n        return this._createQueryableFromLambda(\"and\", lambda);\n    }\n\n    static fromJson(jsonQuery) {\n        let query = queryConverter.convert(jsonQuery);\n        return new Queryable(query.type, query);\n    }\n\n}\n"]}